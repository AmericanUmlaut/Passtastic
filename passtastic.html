<!DOCTYPE html>
<html>
  <head>    
    <meta charset="UTF-8" />
    <style type="text/css">
      label {
        display: inline-block;
        width: 85px;
      }
      
      input.error {
        background-color: rgb(255, 175, 175);
      }
      
      .row {
        margin-bottom: 2px;
      }
      
      #progressBar {
        width: 200px;
        height: 30px;
        background-color: grey;
      }
      #progressBar div {
        background-color: red;
        height: 100%;
        float: left;
      }
    </style>
  </head>

  <body>
    <div class="row">
      <label for="site">Site</label>
      <input id="site" name="site" type="text" data-mandatory="true" onkeyup="updateHash()" />
    </div>
    <div class="row">
      <label for="password">Password</label>
      <input id="password" name="password" type="password" data-mandatory="true" onkeyup="updateHash()" />
    </div>
    <div id="progressBar"><div></div></div>
    <div id="message"></div>
    <div id="output"></div>
    
    <button id="generateBtn">Generate password</button> 
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="MochiKit/MochiKit.js" type="text/javascript"></script>
    <script src="Clipperz/Base.js" type="text/javascript"></script>
    <script src="Clipperz/ByteArray.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/BigInt.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/SHA.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/AES.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/PRNG.js" type="text/javascript"></script>
    <script src="bCrypt.js" type="text/javascript"></script>  
    <script src="passtastic.js" type="text/javascript"></script>  
    <script type="text/javascript">
      (function($) {
        function generateHash() {
          resetProgressBar();
          Passtastic.getBCrypt('test', 
                               function(result) {
                                 // We have to count how many progress steps have actually been taken, because
                                 //bcrypt's progress callback is called an unpredictable number of times.
                                 while(progressCount <= 100) {
                                   updateProgressBar();
                                 }
                                 $('#output').text(result) 
                               },
                               function() {
                                 updateProgressBar();
                               });
        }
        function resetProgressBar() {
          progressCount = 1;
          $('#progressBar div').css('width', 0);
        }
        function updateProgressBar() {
          ++progressCount;
          $('#progressBar div').css('width', progressCount+'%');
        }

        $('#generateBtn').click(function() {
          generateHash();
        });
      })(jQuery);
    </script>
  </body>
</html>