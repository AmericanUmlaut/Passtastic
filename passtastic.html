<!DOCTYPE html>
<html>
  <head>    
    <meta charset="UTF-8" />
    <style type="text/css">
      #container {
        margin: 15px;
        float: left;
        padding: 15px;
        background-color: grey;
        
        -webkit-border-radius: 20px;
        border-radius: 20px;        
      }
      
      input {
        margin-top: 2px;
      }
      
      label {
        display: inline-block;
        width: 115px;
      }
      
      input.error {
        background-color: rgb(255, 175, 175);
      }
      
      .row {
        margin-bottom: 2px;
      }
      
      #output {
        position: absolute;
        left: 20px;
        top: 4px;
      }
      
      #progressBar {
        position: relative; /* Creates positioning context for the output */
        width: 200px;
        height: 30px;
        background-color: grey;
      }
      #progressBar div {
        background-color: red;
        height: 100%;
        float: left;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div class="row">
        <label for="site">Site</label>
        <input id="site" name="site" type="text" value="" />
      </div>
      <div class="row">
        <label for="userName">User Name</label>
        <input id="userName" name="userName" type="text" value="" />
      </div>
      <div class="row">
        <label for="masterPw">Master Password</label>
        <input id="masterPw" name="masterPw" type="password" />
      </div>
      <div id="progressBar"><span id="output"></span><div></div></div>

      <button id="generateBtn">Generate password</button>
    </div>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="MochiKit/MochiKit.js" type="text/javascript"></script>
    <script src="Clipperz/Base.js" type="text/javascript"></script>
    <script src="Clipperz/ByteArray.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/BigInt.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/SHA.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/AES.js" type="text/javascript"></script>
    <script src="Clipperz/Crypto/PRNG.js" type="text/javascript"></script>
    <script src="bCrypt.js" type="text/javascript"></script>  
    <script src="md5.js" type="text/javascript"></script>  
    <script src="passtastic.js" type="text/javascript"></script>  
    <script type="text/javascript">
      (function($) {
        var progressCount;
        
        function generateHash() {
          resetProgressBar();
          
          Passtastic.getPassword($('#site').val(), 
                                 $('#userName').val(), 
                                 $('#masterPw').val(), 
                                 function(result) {
                                   // We have to count how many progress steps have actually been taken, because
                                   //bcrypt's progress callback is called an unpredictable number of times.
                                   while(progressCount < 100) {
                                     updateProgressBar();
                                   }
                                   $('#output').text(result) 
                                 },
                                 function() {
                                   updateProgressBar();
                                 });
        }
        function resetProgressBar() {
          progressCount = 1;
          $('#progressBar div').css('width', 0);
        }
        function updateProgressBar() {
          ++progressCount;
          $('#progressBar div').css('width', progressCount+'%');
        }
        $('#generateBtn').click(function() {          
          generateHash();
        });
      })(jQuery);
    </script>
  </body>
</html>